{% extends "base.html" %}

{% block title %}Dati Temperatura - Energy Insight{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">Dati Temperatura</h1>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Intervallo di Tempo</h5>
            </div>
            <div class="card-body">
                <div class="btn-group" role="group" aria-label="Intervallo di tempo">
                    <button type="button" class="btn btn-outline-primary time-range" data-days="1">Ultime 24h</button>
                    <button type="button" class="btn btn-outline-primary time-range active" data-days="7">Ultima Settimana</button>
                    <button type="button" class="btn btn-outline-primary time-range" data-days="30">Ultimo Mese</button>
                    <button type="button" class="btn btn-outline-primary time-range" data-days="90">Ultimi 3 Mesi</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Andamento Temperature</h5>
            </div>
            <div class="card-body">
                <div id="temp-graph" class="graph-container"></div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Analisi Temperature</h5>
            </div>
            <div class="card-body">
                <p>
                    Questa pagina mostra l'andamento delle temperature dal tuo sistema Home Assistant. 
                    I dati includono sia le temperature interne che esterne, permettendoti di 
                    analizzare la relazione tra queste e il tuo consumo energetico.
                </p>
                <p>
                    I dati di temperatura sono importanti per comprendere l'efficienza del riscaldamento. 
                    Una maggiore differenza tra le temperature interne ed esterne tipicamente 
                    richiede pi√π energia per il riscaldamento.
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
(function() {
    // Parse graph data from server
    var graphData = JSON.parse('{{ graphs|tojson|safe }}');
    
    // Render initial graph
    if (graphData.temp_graph) {
        Plotly.newPlot('temp-graph', JSON.parse(graphData.temp_graph));
    }
    
    // Handle time range buttons
    var timeRangeButtons = document.querySelectorAll('.time-range');
    Array.prototype.forEach.call(timeRangeButtons, function(button) {
        button.addEventListener('click', function() {
            // Update active button
            Array.prototype.forEach.call(timeRangeButtons, function(b) {
                b.classList.remove('active');
            });
            this.classList.add('active');
            
            // Get selected days
            var days = this.getAttribute('data-days');
            
            // Reload the page to get updated graphs
            window.location.href = '{{ url_for("temperature.index") }}?days=' + days;
        });
    });
})();
</script>
{% endblock %}
